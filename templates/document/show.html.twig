{% extends 'base.html.twig' %}

{% block title %}
	{{ document.title }}
	- DocManager
{% endblock %}

{% block body %}
	<div class="page-header">
		<div>
			<h1 class="page-title">ğŸ“„
				{{ document.title }}</h1>
			<p class="page-subtitle">Document details</p>
		</div>
		<div class="page-actions">
			{% if document.isPdf() or document.isImage() %}
				<a href="{{ path('app_document_preview', {id: document.id}) }}" target="_blank" class="btn btn-info">ğŸ‘ï¸ Preview</a>
			{% endif %}
			<a href="{{ path('app_document_download', {id: document.id}) }}" class="btn btn-success">â¬‡ Download</a>
			<a href="{{ path('app_document_edit', {id: document.id}) }}" class="btn btn-secondary">âœï¸ Edit</a>
			<a href="{{ path('app_document_index') }}" class="btn btn-secondary">â† Back</a>
		</div>
	</div>

	{# Preview Section #}
	{% if document.fileName %}
		{% set isImage = document.mimeType starts with 'image/' %}
		{% set isPdf = document.mimeType == 'application/pdf' %}

		<div class="card">
			<h2 class="card-title mb-2">ğŸ‘ï¸ Preview</h2>
			<div style="background: rgba(0,0,0,0.3); border-radius: 12px; padding: 1.5rem; text-align: center; min-height: 250px; display: flex; align-items: center; justify-content: center;">
				{% if isImage %}
					<img src="{{ vich_uploader_asset(document, 'file') }}" alt="{{ document.title }}" style="max-width: 100%; max-height: 450px; border-radius: 8px;">
				{% elseif isPdf %}
					<iframe src="{{ vich_uploader_asset(document, 'file') }}" width="100%" height="500px" style="border: 1px solid var(--border-color); border-radius: 8px;"></iframe>
				{% else %}
					<div style="text-align: center;">
						<div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ“„</div>
						<p class="text-muted">{{ document.originalName ?? document.fileName }}</p>
						<p class="text-muted" style="font-size: 0.8rem;">{{ document.mimeType }}
							â€”
							{{ document.size ? (document.size / 1024)|number_format(1) ~ ' KB' : '' }}</p>
					</div>
				{% endif %}
			</div>
		</div>
	{% endif %}

	{# Document Details #}
	<div class="card">
		<h2 class="card-title mb-2">ğŸ“‹ Details</h2>
		<div class="detail-list">
			<div class="detail-item">
				<div class="detail-label">Title</div>
				<div class="detail-value">{{ document.title }}</div>
			</div>
			<div class="detail-item">
				<div class="detail-label">Description</div>
				<div class="detail-value">{{ document.description ? document.description|raw : '<span class="text-muted">No description</span>'|raw }}</div>
			</div>
			<div class="detail-item">
				<div class="detail-label">Client</div>
				<div class="detail-value">
					{% if document.client %}
						<a href="{{ path('app_client_show', {id: document.client.id}) }}">{{ document.client.firstName }}
							{{ document.client.lastName }}</a>
					{% else %}
						<span class="text-muted">â€”</span>
					{% endif %}
				</div>
			</div>

			<div class="detail-item">
				<div class="detail-label">File</div>
				<div class="detail-value">{{ document.originalName ?? document.fileName ?? 'â€”' }}</div>
			</div>
			<div class="detail-item">
				<div class="detail-label">Size</div>
				<div class="detail-value">
					{% if document.size %}
						{{ (document.size / 1024)|number_format(1) }}
						KB
					{% else %}
						<span class="text-muted">â€”</span>
					{% endif %}
				</div>
			</div>
			<div class="detail-item">
				<div class="detail-label">Uploaded by</div>
				<div class="detail-value">{{ document.owner.userIdentifier }}</div>
			</div>
			<div class="detail-item">
				<div class="detail-label">Uploaded on</div>
				<div class="detail-value">{{ document.createdAt|date('d/m/Y H:i') }}</div>
			</div>
			<div class="detail-item">
				<div class="detail-label">Last updated</div>
				<div class="detail-value">{{ document.updatedAt ? document.updatedAt|date('d/m/Y H:i') : 'Never' }}</div>
			</div>
		</div>
	</div>

	{# Delete (Soft Delete) #}
	<div class="card" style="border-color: rgba(239, 68, 68, 0.3);">
		<h3 class="text-red mb-2">ğŸ—‘ï¸ Move to Trash</h3>
		<p class="text-muted mb-2">This document will be moved to trash. You can restore it later.</p>
		<form method="post" action="{{ path('app_document_delete', {id: document.id}) }}" onsubmit="return confirm('Move this document to trash?');">
			<input type="hidden" name="_token" value="{{ csrf_token('delete-document-' ~ document.id) }}">
			<button type="submit" class="btn btn-danger">ğŸ—‘ï¸ Move to Trash</button>
		</form>
	</div>
{% endblock %}
