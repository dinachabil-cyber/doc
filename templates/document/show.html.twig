{% extends 'base.html.twig' %}

{% block title %}
	{{ document.title }}
	- DocManager
{% endblock %}

{% block body %}
	<div class="page-header">
		<div>
			<h1 class="page-title">ğŸ“„
				{{ document.title }}</h1>
			<p class="page-subtitle">Document details</p>
		</div>
		<div class="page-actions">
			{% if document.fileName %}
				<a href="{{ path('app_document_view', {id: document.id}) }}" class="btn btn-info">ğŸ‘ï¸ View</a>
			{% endif %}
			{% if is_granted('DOCUMENT_DOWNLOAD') %}
				<a href="{{ path('app_document_download', {id: document.id}) }}" class="btn btn-success">â¬‡ Download</a>
			{% endif %}
			{% if is_granted('DOCUMENT_EDIT') %}
				<a href="{{ path('app_document_edit', {id: document.id}) }}" class="btn btn-secondary">âœï¸ Edit</a>
			{% endif %}
			<a href="{{ path('app_document_index') }}" class="btn btn-secondary">â† Back</a>
		</div>
	</div>

	{# Document Details #}
	<div class="card">
		<h2 class="card-title mb-2">ğŸ“‹ Details</h2>
		<div class="detail-list">
			<div class="detail-item">
				<div class="detail-label">Title</div>
				<div class="detail-value">{{ document.title }}</div>
			</div>
			<div class="detail-item">
				<div class="detail-label">Description</div>
				<div class="detail-value">{{ document.description ? document.description|raw : '<span class="text-muted">No description</span>'|raw }}</div>
			</div>
			<div class="detail-item">
				<div class="detail-label">Client</div>
				<div class="detail-value">
					{% if document.client %}
						{% if is_granted('CLIENT_VIEW') %}
							<a href="{{ path('app_client_show', {id: document.client.id}) }}">{{ document.client.firstName }}
								{{ document.client.lastName }}</a>
						{% else %}
							{{ document.client.firstName }} {{ document.client.lastName }}
						{% endif %}
					{% else %}
						<span class="text-muted">â€”</span>
					{% endif %}
				</div>
			</div>

			<div class="detail-item">
				<div class="detail-label">File</div>
				<div class="detail-value">{{ document.originalName ?? document.fileName ?? 'â€”' }}</div>
			</div>
			<div class="detail-item">
				<div class="detail-label">Size</div>
				<div class="detail-value">
					{% if document.size %}
						{{ (document.size / 1024)|number_format(1) }}
						KB
					{% else %}
						<span class="text-muted">â€”</span>
					{% endif %}
				</div>
			</div>
			<div class="detail-item">
				<div class="detail-label">Uploaded by</div>
				<div class="detail-value">{{ document.owner.userIdentifier }}</div>
			</div>
			<div class="detail-item">
				<div class="detail-label">Uploaded on</div>
				<div class="detail-value">{{ document.createdAt|date('d/m/Y H:i') }}</div>
			</div>
			<div class="detail-item">
				<div class="detail-label">Last updated</div>
				<div class="detail-value">{{ document.updatedAt ? document.updatedAt|date('d/m/Y H:i') : 'Never' }}</div>
			</div>
		</div>
	</div>

	{# Delete (Soft Delete) - only for users with DOCUMENT_DELETE permission #}
	{% if is_granted('DOCUMENT_DELETE') %}
		<div class="card" style="border-color: rgba(239, 68, 68, 0.3);">
			<h3 class="text-red mb-2">ğŸ—‘ï¸ Move to Trash</h3>
			<p class="text-muted mb-2">This document will be moved to trash. You can restore it later.</p>
			<form method="post" action="{{ path('app_document_delete', {id: document.id}) }}" onsubmit="return confirm('Move this document to trash?');">
				<input type="hidden" name="_token" value="{{ csrf_token('delete-document-' ~ document.id) }}">
				<button type="submit" class="btn btn-danger">ğŸ—‘ï¸ Move to Trash</button>
			</form>
		</div>
	{% endif %}
{% endblock %}
