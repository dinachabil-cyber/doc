{% extends 'base.html.twig' %}

{% block title %}Documents -
	{{ client.firstName }}
	{{ client.lastName }}
	- DocManager
{% endblock %}

{% block body %}
	<div class="page-header">
		<div>
			<h1 class="page-title">ğŸ“„ Documents</h1>
			<p class="page-subtitle">Documents for
				{{ client.firstName }}
				{{ client.lastName }}</p>
		</div>
		<div class="page-actions">
			{% if is_granted('DOCUMENT_UPLOAD') %}
				<a href="{{ path('app_document_new', {id: client.id}) }}" class="btn btn-primary">â• Upload Document</a>
			{% endif %}
			{% if is_granted('CLIENT_VIEW') %}
				<a href="{{ path('app_client_show', {id: client.id}) }}" class="btn btn-secondary">â† Back</a>
			{% endif %}
		</div>
	</div>

	{% if documents is empty %}
		<div class="card">
			<div class="empty-state">
				<div class="empty-state-icon">ğŸ“‚</div>
				<h3>No documents yet</h3>
				<p>Upload the first document for this client.</p>
				{% if is_granted('DOCUMENT_UPLOAD') %}
					<a href="{{ path('app_document_new', {id: client.id}) }}" class="btn btn-primary">â• Upload Document</a>
				{% endif %}
			</div>
		</div>
	{% else %}
		<div class="card" style="padding: 0; overflow: hidden;">
			<div class="table-container">
				<table>
					<thead>
						<tr>
							<th>Title</th>
							<th>File</th>
							<th>Type</th>
							<th>Size</th>
							<th>Uploaded</th>
							<th>Actions</th>
						</tr>
					</thead>
					<tbody>
						{% for doc in documents %}
							<tr>
								<td>
									<a href="{{ path('app_document_show', {id: doc.id}) }}" style="font-weight: 600;">{{ doc.title }}</a>
								</td>
								<td class="text-muted" style="max-width: 180px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
									{% set fileIcon %}
										{% if doc.isPdf() %}
											ğŸ“„
										{% elseif doc.isImage() %}
											ğŸ–¼ï¸
										{% else %}
											ğŸ“
										{% endif %}
									{% endset %}
									<span class="file-icon">{{ fileIcon }}</span> {{ doc.originalName ?? doc.fileName ?? 'â€”' }}
								</td>
								<td>
									<span class="badge badge-purple">{{ doc.mimeType ? doc.mimeType|split('/')|last : 'â€”' }}</span>
								</td>
								<td>
									{% if doc.size %}
										{{ (doc.size / 1024)|number_format(1) }}
										KB
									{% else %}
										<span class="text-muted">â€”</span>
									{% endif %}
								</td>
								<td class="text-muted">{{ doc.createdAt|date('d/m/Y H:i') }}</td>
								<td>
									<div style="display: flex; gap: 0.5rem;">
										{% if doc.isPdf() or doc.isImage() %}
											<a href="{{ path('app_document_preview', {id: doc.id}) }}" data-preview="{{ path('app_document_preview', {id: doc.id}) }}" class="btn btn-sm btn-info">ğŸ‘ï¸ Preview</a>
										{% endif %}
										{% if is_granted('DOCUMENT_DOWNLOAD') %}
											<a href="{{ path('app_document_download', {id: doc.id}) }}" class="btn btn-sm btn-success">â¬‡</a>
										{% endif %}
										<a href="{{ path('app_document_show', {id: doc.id}) }}" class="btn btn-sm btn-secondary">View</a>
										{% if is_granted('DOCUMENT_DELETE') %}
											<form method="post" action="{{ path('app_document_delete', {id: doc.id}) }}" class="inline-form" onsubmit="return confirm('Delete this document?');">
												<input type="hidden" name="_token" value="{{ csrf_token('delete-document-' ~ doc.id) }}">
												<button type="submit" class="btn btn-sm btn-danger">ğŸ—‘</button>
											</form>
										{% endif %}
									</div>
								</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</div>
	{% endif %}
{% endblock %}
