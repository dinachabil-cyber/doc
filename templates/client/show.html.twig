{% extends 'base.html.twig' %}

{% block title %}
	{{ client.firstName }}
	{{ client.lastName }}
	- DocManager
{% endblock %}

{% block body %}
	<div class="page-header">
		<div>
			<h1 class="page-title">ğŸ‘¤
				{{ client.firstName }}
				{{ client.lastName }}</h1>
			<p class="page-subtitle">Client details and documents</p>
		</div>
		<div class="page-actions">
			<a href="{{ path('app_client_edit', {id: client.id}) }}" class="btn btn-secondary">âœï¸ Edit</a>
			<a href="{{ path('app_document_new', {id: client.id}) }}" class="btn btn-primary">ğŸ“„ Upload</a>
		</div>
	</div>

	{# Stats #}
	<div class="stats-grid">
		<div class="stat-card">
			<div class="stat-icon cyan">ğŸ“„</div>
			<div>
				<div class="stat-value">{{ client.documents|length }}</div>
				<div class="stat-label">Documents</div>
			</div>
		</div>
		<div class="stat-card">
			<div class="stat-icon green">ğŸ“…</div>
			<div>
				<div class="stat-value">{{ client.createdAt|date('d/m') }}</div>
				<div class="stat-label">Since</div>
			</div>
		</div>
	</div>

	{# Client Details #}
	<div class="card">
		<div class="card-header">
			<h2 class="card-title">ğŸ“‹ Client Details</h2>
		</div>
		<div class="detail-list">
			<div class="detail-item">
				<div class="detail-label">Full Name</div>
				<div class="detail-value">{{ client.firstName }}
					{{ client.lastName }}</div>
			</div>
			<div class="detail-item">
				<div class="detail-label">Email</div>
				<div class="detail-value">
					{% if client.email %}
						<a href="mailto:{{ client.email }}">{{ client.email }}</a>
					{% else %}
						<span class="text-muted">Not provided</span>
					{% endif %}
				</div>
			</div>
			<div class="detail-item">
				<div class="detail-label">Phone</div>
				<div class="detail-value">
					{% if client.phone %}
						<a href="tel:{{ client.phone }}">{{ client.phone }}</a>
					{% else %}
						<span class="text-muted">Not provided</span>
					{% endif %}
				</div>
			</div>
			<div class="detail-item">
				<div class="detail-label">Address</div>
				<div class="detail-value">{{ client.address ? client.address|raw : '<span class="text-muted">Not provided</span>'|raw }}</div>
			</div>
			<div class="detail-item">
				<div class="detail-label">Created</div>
				<div class="detail-value">{{ client.createdAt|date('d/m/Y H:i') }}</div>
			</div>
		</div>
	</div>

	{# Documents #}
	<div class="card" style="padding: 0; overflow: hidden;">
		<div class="card-header">
			<h2 class="card-title">ğŸ“„ Documents ({{ client.documents|length }})</h2>
			<a href="{{ path('app_document_new', {id: client.id}) }}" class="btn btn-sm btn-primary">â• Upload</a>
		</div>

		{% if client.documents is empty %}
			<div class="empty-state">
				<div class="empty-state-icon">ğŸ“‚</div>
				<h3>No documents yet</h3>
				<p>Upload the first document for this client.</p>
			</div>
		{% else %}
			<div class="table-container">
				<table>
					<thead>
						<tr>
							<th>Title</th>
							<th>File</th>
							<th>Size</th>
							<th>Uploaded</th>
							<th>Actions</th>
						</tr>
					</thead>
					<tbody>
						{% for doc in client.documents %}
							<tr>
								<td>
									<a href="{{ path('app_document_show', {id: doc.id}) }}" style="font-weight: 600;">{{ doc.title }}</a>
								</td>
								<td class="text-muted">{{ doc.originalName ?? doc.fileName ?? 'â€”' }}</td>
								<td>
									{% if doc.size %}
										{{ (doc.size / 1024)|number_format(1) }}
										KB
									{% else %}
										<span class="text-muted">â€”</span>
									{% endif %}
								</td>
								<td class="text-muted">{{ doc.createdAt|date('d/m/Y') }}</td>
								<td>
									<div style="display: flex; gap: 0.5rem;">
										<a href="{{ path('app_document_download', {id: doc.id}) }}" class="btn btn-sm btn-success">â¬‡</a>
										<a href="{{ path('app_document_show', {id: doc.id}) }}" class="btn btn-sm btn-secondary">View</a>
										<form method="post" action="{{ path('app_document_delete', {id: doc.id}) }}" class="inline-form" onsubmit="return confirm('Delete this document?');">
											<input type="hidden" name="_token" value="{{ csrf_token('delete-document-' ~ doc.id) }}">
											<button type="submit" class="btn btn-sm btn-danger">ğŸ—‘</button>
										</form>
									</div>
								</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		{% endif %}
	</div>

	{# Delete #}
	<div class="card" style="border-color: rgba(239, 68, 68, 0.3);">
		<h3 class="text-red mb-2">âš ï¸ Danger Zone</h3>
		<p class="text-muted mb-2">Deleting a client will also delete all their documents. This action cannot be undone.</p>
		<form method="post" action="{{ path('app_client_delete', {id: client.id}) }}" onsubmit="return confirm('Are you sure? This will delete ALL documents for this client.');">
			<input type="hidden" name="_token" value="{{ csrf_token('delete-client-' ~ client.id) }}">
			<button type="submit" class="btn btn-danger">ğŸ—‘ Delete Client</button>
		</form>
	</div>
{% endblock %}
