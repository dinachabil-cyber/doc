{% extends 'base.html.twig' %}

{% block title %}Reset Password - DocManager{% endblock %}

{% block html_prepend %}
    <meta name="turbo-visit-control" content="disabled">
{% endblock %}

{% block auth_body %}
<div class="auth-card">
    <div class="auth-header">
        <div class="auth-icon">ðŸ”’</div>
        <h1 class="auth-title">Create New Password</h1>
        <p class="auth-subtitle">Enter your new password below</p>
    </div>

    <form method="post" action="" data-turbo="false">
        <input type="hidden" name="token" value="{{ token }}">
        <input type="hidden" name="_csrf_token" value="{{ csrf_token('reset_password') }}">

        <div class="form-group">
            <label class="form-label" for="inputPassword">New Password</label>
            <input type="password" 
                   name="password" 
                   id="inputPassword" 
                   class="form-control {% if errors.password is defined %}is-invalid{% endif %}" 
                   autocomplete="new-password" 
                   required 
                   placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            {% if errors.password is defined %}
                <div class="form-error">{{ errors.password }}</div>
            {% else %}
                <small class="form-hint">
                    Must be at least 8 characters with uppercase, lowercase, and number
                </small>
            {% endif %}
        </div>

        <div class="form-group">
            <label class="form-label" for="inputConfirmPassword">Confirm New Password</label>
            <input type="password" 
                   name="confirm_password" 
                   id="inputConfirmPassword" 
                   class="form-control {% if errors.confirm_password is defined %}is-invalid{% endif %}" 
                   autocomplete="new-password" 
                   required 
                   placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            {% if errors.confirm_password is defined %}
                <div class="form-error">{{ errors.confirm_password }}</div>
            {% endif %}
        </div>

        <!-- Password Strength Indicator -->
        <div class="password-strength" id="passwordStrength">
            <div class="strength-bar">
                <div class="strength-fill" id="strengthFill"></div>
            </div>
            <span class="strength-text" id="strengthText"></span>
        </div>

        <button class="btn btn-primary btn-lg btn-block" type="submit">
            <span class="btn-icon">âœ“</span>
            Reset Password
        </button>
    </form>

    <div class="auth-footer">
        <a href="{{ path('app_login') }}">Back to Sign In</a>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const passwordInput = document.getElementById('inputPassword');
    const strengthFill = document.getElementById('strengthFill');
    const strengthText = document.getElementById('strengthText');
    const strengthBar = document.getElementById('passwordStrength');

    passwordInput.addEventListener('input', function() {
        const password = this.value;
        let strength = 0;

        if (password.length >= 8) strength += 25;
        if (password.length >= 12) strength += 15;
        if (/[A-Z]/.test(password)) strength += 20;
        if (/[a-z]/.test(password)) strength += 20;
        if (/[0-9]/.test(password)) strength += 10;
        if (/[^A-Za-z0-9]/.test(password)) strength += 10;

        strength = Math.min(100, strength);

        strengthFill.style.width = strength + '%';

        if (strength < 30) {
            strengthFill.className = 'strength-fill weak';
            strengthText.textContent = 'Weak';
            strengthText.className = 'strength-text weak';
        } else if (strength < 60) {
            strengthFill.className = 'strength-fill fair';
            strengthText.textContent = 'Fair';
            strengthText.className = 'strength-text fair';
        } else if (strength < 80) {
            strengthFill.className = 'strength-fill good';
            strengthText.textContent = 'Good';
            strengthText.className = 'strength-text good';
        } else {
            strengthFill.className = 'strength-fill strong';
            strengthText.textContent = 'Strong';
            strengthText.className = 'strength-text strong';
        }

        if (password.length === 0) {
            strengthBar.style.display = 'none';
        } else {
            strengthBar.style.display = 'flex';
        }
    });
});
</script>

<style>
.password-strength {
    display: none;
    align-items: center;
    gap: 10px;
    margin-bottom: 1.5rem;
}

.strength-bar {
    flex: 1;
    height: 6px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
    overflow: hidden;
}

.strength-fill {
    height: 100%;
    transition: width 0.3s ease, background-color 0.3s ease;
    border-radius: 3px;
}

.strength-fill.weak { background-color: #ef4444; }
.strength-fill.fair { background-color: #f59e0b; }
.strength-fill.good { background-color: #10b981; }
.strength-fill.strong { background-color: #667eea; }

.strength-text {
    font-size: 0.85rem;
    font-weight: 500;
    min-width: 50px;
}

.strength-text.weak { color: #ef4444; }
.strength-text.fair { color: #f59e0b; }
.strength-text.good { color: #10b981; }
.strength-text.strong { color: #667eea; }
</style>
{% endblock %}
